import re
import scrapy
from scrapy.spiders import SitemapSpider
from datetime import datetime
import pyodbc
import json
from contorion.items import ProductItem, SpecItem

class MySitemapSpider(SitemapSpider):
    name = 'contorion'
    sitemap_urls = ['https://www.contorion.de/pdp_index.xml']
    sitemap_rules = [
        ("/prebena","parse"),
        ("/bosch","parse"),
        ("/dunlop","parse"),
        ("/hoppe","parse"),
        ("/husqvarna","parse"),
        ("/makita","parse")
    ]
    def __init__(self, *a, **kw):
        super(MySitemapSpider,self).__init__(*a, **kw)
        self.sysgtin = {"04012789279252","04053423221626","00088381404747","07630153439865","04012789330687","00088381077699","00088381337106","00088381414371","00088381420143","00088381455503","00088381497640","00088381165235","00088381165914","00088381204828","00088381204880","00088381204910","00088381313759","00088381408769","00088381533096","00088381575980","00088381592338","00088381791267","00088381291194","00088381973434","03240890252555","00088381585170","00088381351959","00088381425537","03240890016027","00088381197588","04228078422807","00088381525220","00088381361491","03240890372888","00000886191700","00088381109734","00088381777223","04002829495599","04002829852880","00088381803328","00088381741392","00197050000262","03240890902306","00088381359658","00088381169158","00088381169356","00088381587174","04062321640156","08020119042274","00088381335959","00088381418614","00088381485067","00088381897525","07333377033399","07333377397514","07391736178785","07391736265928","07391736392068","07391883079423","07392930544543","07393080348913","00197050002051","00088381253819","04064677123505","00088381161060","00088381159005","00088381149211","03240891006096","00088381566278","00088381427982","00088381582674","00088381580892","07391883725849","07391883734032","07392930300118","07392930300279","07392930300385","07393089175336","00088381136150","00088381201094","00088381352345","00088381355186","00088381454339","00088381458566","00088381468633","00088381587495","00088381587501","00088381703185","00088381921459","03240890275318","03240890397409","00088381584111","00088381410397","00088381574334","00088381599986","00088381790598","00088381790628","00088381791045","00088381968317","00197050005366","04053423253016","00088381798723","00883816844446","07393080738189","00088381762267","01110003476210","00088381851282","00088381737708","00088381754286","04250559923091","00088381334792","04250559983446","04250559984313","04250559983378","04250559987918","04250559987901","04064677041335","03165140726962","03165140383301","00088381950756","00883819465136","07630153439964","00088381149280","00088381337243","00088381414357","00088381440226","00088381476515","00088381529372","00088381537384","00088381165655","00088381166225","00088381204934","00088381349864","00088381560627","00883817866690","00088381787994","00088381294140","00088381294201","00088381945028","00088381947022","00088381970402","00088381970518","00088381994989","00088381787888","00088381362412","00088381468589","00088381497794","00088381350624","00000885136337","03240890900371","00088381100816","00088381526296","00088961017701","05711145243034","00088381201193","00088381404433","00883810328584","00088381043465","00088381400930","00088381549141","00088381883580","07391883002421","07391883219157","07391883425633","07391883801697","07391883814475","07392930126435","07392930641983","07392930728127","00197050002198","00088381248334","07391883513712","07391883513743","00197050001900","04064677123543","04062321882129","03240890258571","00088381704229","00088381353281","00088381160704","00088381158879","00088381474931","00088381566261","00088381566230","00088381582612","00088381597012","00088381992480","00088381849050","00088381407281","00088381423847","00088381629171","04250794609088","07391883008072","07392930300002","07392930300101","07392930300514","07392930544697","00088381154949","00088381160001","00088381201155","00088381350471","00088381362122","00088381401524","00088381422260","00088381483162","00088381548113","00088381947961","03240890369260","00088381364430","00088381447362","00088381477888","00088381114233","00088381114929","00088381291484","00088381383677","00088381433334","00088381597746","00088381790727","00088381790833","00088381790895","00088381791014","00088381791069","04002829251591","01110003441799","07392930965843","00088381414227","00088381798709","00088381665919","04053423257137","00088381739269","07333377057364","07333377033405","00088381763721","00088381874052","00088381832151","04250559912309","04250559978558","04250559994176","04053423242140","03165140384339","00088381737753","00088381079747","00088381448147","00088381537759","00088381187213","00088381187237","00088381204842","00088381343466","00088381404785","00088381497121","00088381549196","00088381549202","00088381566810","00088381292603","00088381972017","00088381972475","00088381970914","00088381709651","00088381436021","00088381127523","00088381357128","00088381458948","00088381531795","00088381542135","00088381495790","00088381448307","00088381442190","03240890061843","06322746322746","00088381538572","00088381792752","00088381669931","00088381775182","00088381485920","00088381839129","04005337021410","00088381194747","00088381548823","00088381782760","00088381178624","00088381149020","00088381194921","00088381056793","00088381337120","00088381416580","00088381422284","00088381867412","07391736617536","07391883986356","07392930729049","07392930887725","00088381731621","04056835203266","07392930965836","07333377032637","04064677035266","04250559901433","00088381404969","00088381353304","00088381355056","00088381436656","00088381436731","00088381704090","00088381200547","00088381597265","07391883725962","07391883726167","07392930286184","07392930299924","07392930300231","00088381142687","00088381144193","00088381162821","00088381162876","00088381164450","00088381367103","00088381430753","00088381458610","00088381488075","00088381579537","00088381587464","00088381921275","00088381949163","00088381968232","00088381968256","00088381970785","03240890354792","00088381585811","00088381931342","00088381114585","00088381291774","00088381586825","00088381790819","00088381790826","00088381864091","00088381946759","03165140638838","04250845510868","00088381642224","00088381641357","00088381828017","04056835203273","00088381836906","00088381732932","00088381828970","06924328308225","04250559915164","04250559983132","04250559983408","04250559987970","03165140909068","00088381437394","00088381448185","00088381537964","00088381538015","00088381165969","00088381788007","00088381294683","00088381972109","00088381973250","01546253981462","00088381343565","00088381488945","00088381518741","06505242650524","04002829764541","04002829351284","00088381993401","00088381894678","00088381493383","00088381447829","00088381559836","00088381776639","00088381187565","00088381161800","00088381654722","00088381026277","00088381151665","00088381337052","00088381400305","00088381400749","00088381764612","07340014863158","07391883814468","07392930356740","07392930887756","00088381248358","04056835203204","04053423252996","04064677035235","04064677123598","00088381485937","00088381134347","00088381453462","00088381574471","00088381566155","00088381572941","00088381481779","00088381760362","00883816509390","07391736511100","07391883726082","07393080693860","07393080704108","07393080871572","00088381162654","00088381162944","00088381351584","00088381369992","00088381402170","00088381422277","00088381456531","00088381456616","00088381526104","00088381579469","00088381587471","00088381788816","00088381913362","00088381946964","03240890316684","03240890367600","00088381399487","03240890348234","00088381291507","00088381291767","00088381790536","00088381790543","00088381790697","00088381790956","00088381791106","00088381798730","01110003589743","01110003584717","00088381204927","00088381883627","07391736161503","04056835203242","00088381874434","00088381114318","00088381899321","00088381655743","04250559905431","04250559977438","04064677008635","04064677041434","00088381594998","03165140489683","00088381353694","00088381437813","00088381537995","00088381187008","00088381187572","00088381194761","00088381345842","00088381539753","00088381560467","00088381582261","00088381594288","00088381786645","00088381291392","00088381291415","00088381773744","00088381972765","00088381970525","00088381970693","00088381122009","00088381433792","04002829442876","04002829831359","03240890276629","00000886322715","03240890117373","00088381191395","00088381526081","03240890310750","00088381819602","04002829761267","04002829243213","00088381771894","00088381493260","00088381970303","00088381161787","00088381484381","00088381433389","00088381169295","00088381968300","00088381710084","00088381867801","00088381369350","00088381403412","00088381473460","00088381518734","00088381585194","00088381587402","00088381595186","00088381781022","00197050002662","07391736176286","07391883986721","07392930642003","07392930730083","00088381770330","00088381248372","03165140952842","04064677127824","04064677123581","00088381353274","00088381185882","00088381149136","00088381158848","00088381580175","00088381469227","00088381918039","00088381574990","00088381434850","00088381462310","01000001998909","07391883695616","07391883726051","07392930326057","07393080694393","00088381152761","00088381360319","00088381413206","00088381424530","00088381435062","00088381483179","00088381584128","00088381587433","00088381788830","00088381913379","00088381980593","00088381982641","00088381135252","00088381360517","00088381399456","00088381399463","00088381416399","00088381572347","03240890469731","00088381376259","00088381790666","00088381827980","00088381844604","00088381945899","00088381964340","01110003479419","00088381858236","00088381367080","00088381414197","00088381448277","00088381798679","04056835203167","07333377093133","00088381580526","04053423252583","00088381843034","00088381772181","00088381874380","00088381839174","04250559900559","03165140704533","04250559966463","00088381558624","03165140336932","03165140848619","00197050001788","07630153439858","00088381248747","00088381336956","00088381165846","00088381475808","00088381549882","00088381560481","00088381582278","00088381764223","00088381291323","00088381292696","00088381294669","00088381970419","00088381970433","00088381158213","04002829906811","00088381101530","00088381542555","03240890115294","03240890274465","00088381191401","00088381566100","00088381400480","00088381781541","00088381484558","00088381130882","00088381169103","00088381169172","00088381187558","00088381549219","00088381594523","00088381149068","00088381590181","00088381073554","00088381248785","00088381336857","00088381477581","00088381719674","00088381762571","05414133165379","07391736617529","07392930286146","07392930730205","07393080485793","00088381248365","01000000431209","04064677076672","04260481139323","04064677123499","04064677123567","00088381353229","00088381486828","00088381953115","00088381469197","00088381595407","04002829486030","00088381572989","00088381992725","00088381548243","00088381312790","03240890324009","00088381546744","00088381538640","00088381780445","00088381836746","00088381836920","07391883008164","07391883048337","07391883079409","07391883142264","07391883211267","07391883726099","07392930300286","07392930300293","07392930300361","07392930300446","07392930300538","00088381162777","00088381164474","00088381310796","00088381372008","00088381409070","00088381419161","00088381422192","00088381422246","00088381455008","00088381457316","00088381579483","00088381598859","00088381703154","00088381967334","00088381970808","04002829846056","00088381415644","00088381790390","00088381790659","00088381791113","00088381975162","00088381884648","01110003476203","01110003542755","00088381152273","04056835190160","00088381864084","00088381875585","00088381899888","04250559912279","04250559983422","04250559983354","04250559994183","04250559995005","04053423232059","04053423218633","03165140385039","00088381291736","00088381477062","00088381404693","00088381597760","03165140495820","04012789325171","07630153439919","07630153439896","07630153439957","00088381337175","00088381169301","00088381182911","00088381165815","00088381359450","00088381788014","00088381292580","00088381294133","00088381972499","00088381973427","00088381990370","00088381995184","00088381995702","00088381709576","00088381453950","00088381787437","00000882132738","00000882134992","00088381195454","03240890356338","00088381406086","00088381867542","00088381570329","00088381768351","05541298874621","03240890425355","00088381476430","00088381781428","00088381586894","00088381149129","00088381560795","00088381292634","00088381336604","00088381400787","00088381536745","00088381708722","00088381783729","07391883005651","07392930327788","07392930887657","08720023002943","07333377483828","04064677035259","04064677123574","00088381485883","00088381478175","00088381436830","00088381149075","00088381343282","00088381149167","00088381158817","00088381158831","00088381149150","00088381477734","00088381472753","00088381585767","00088381477468","00088381161367","00088381573085","00088381521239","00088381521260","00088381521451","00088381202954","00088381992688","00088381348430","00088381469005","00088381808019","07391883154823","07392930300255","00088381104968","00088381163026","00088381345132","00088381422123","00088381438124","00088381483209","00088381586108","00088381598835","00088381922968","03240890363404","00088381399470","00088381570848","00088381292337","00088381436762","00088381790918","00088381968515","04053423252446","04056835203228","00088381414340","00088381798686","01110003607171","00088381439923","01110003533029","00088381993302","00088381658782","00088381972222","00088381772211","00088381867924","00088381899710","00088381854474","00088381873574","00088381174091","04250559912286","04250559992783","04059952624983","04059952643328","00088381594912","03165140092036","00088381521963","00088381537421","00088381538046","00088381165853","00088381205153","00088381792042","00088381972734","00088381973229","00088381973267","00088381970945","00088381990332","00088381202992","00088381443203","00088381589178","00088418142000","00000884234522","04002829831120","04547684454768","00088381453417","04002829798928","00000885165788","04002829371916","00088381474979","00088381990745","00088381191197","03240890469717","00088381781404","00088381484336","00088381353632","00088381791151","00088381943321","01000001725314","00088381097567","00088381418188","00088381723749","00088381777773","07333377056329","07391883036860","07391883620687","07391883814451","07392930511545","07393080485618","07393080485724","06925387186137","00088381160957","04056835202719","00088381207133","04056835202702","00088381156035","04064677076689","04250559924432","00088381353298","00088381158824","00088381158855","00088381472760","00088381573054","00088381521352","00088381128742","04033164093218","00088381883597","07391883179659","07391883725931","07392930300071","07392930300149","00088381150156","00088381162951","00088381457989","00088381488082","00088381525619","00088381597258","00088381970747","00088381982672","04046382082827","00088381473729","00088381536189","04002829789247","00088381436922","00088381586863","00088381790611","00088381790796","00088381791021","00088381791205","00088381946735","00088381414364","00088381415163","04002829851609","03165140033435","00088381896856","04053423246759","00088381463911","07333377033337","00088381748452","00088381873611","00088381740272","00088381996921","04250559908883","04250559966494","04250559983385","04250559994169","04064677041397","03165140385770","00088381791922","00088381131612","00088381150927","00088381150934","00088381490078","00088381537896","00088381169332","00088381313711","00088381497411","00088381582247","00088381592321","00088381594202","00088381787970","00088381291149","00088381292207","00088381293433","00088381294195","00088381294652","00088381294690","00088381961493","00088381973182","00088381970426","00088381970495","00088381970686","00088381970891","00088381984430","00088381990349","00088381995177","01264104326698","01549730288719","00088381525237","00088381791892","00088381111140","04002829768457","00851791413216","08025518072945","00088381792073","00088381868259","00088381867917","00088381683654","03240890250650","00088381161794","00088381360586","00088381566391","00088381562317","00088381979627","00088381148986","00088381149044","00088381137461","00088381586856","00088381705516","00088381336055","00088381416597","00088381418171","00088381640855","00088381751490","05050438002836","07333377035409","07391736638890","07391883805497","07392930290501","07392930651586","07392930887640","08838143804962","06925387184935","00088381943338","00088381702218","04056835203327","08020119042267","04064677035327","00088381161831","00088381149099","00088381158886","03240890433633","00088381469203","00088381566254","00088381200554","00088381521901","00088381582704","00088381787147","00088381200776","00088381566483","07391883154830","07392930300057","00088381142380","00088381150231","00088381159173","00088381162999","00088381201148","00088381555968","00088381570770","00088381594394","00088381598910","00088381917537","00088381921381","00088381571357","00088381102728","00088381376952","00088381436908","00088381481625","00088381586818","03240890364661","01110003539366","00088381741422","07333377075696","04012789512571","07391736368162","00088381992824","00088381992770","07391883815304","00088381056373","06924328322580","00088381899314","00088381354240","00088381710367","04250559966456","04064677041328","04064677095574","03165140077606","04053423252255","04059952643304","03165140909044","00088381478434","00088381442640","00088381186988","00088381291378","00088381292658","00088381293440","00088381961882","00088381973205","00088381970464","00088381970549","00088381970662","00088381111638","04002829722923","00815151856235","00088381129770","00088381351935","00088381149907","00088381114691","03240890025623","04002829156124","00088381070607","00088381867931","00088381990721","00088381621243","00088381970310","00088381992343","00088381559768","07393033049171","00088381151016","00088381174404","00088381336093","00088381336970","00088381362146","00088381781244","00088381801270","00883810833026","07391883142103","07392930736900","07392930973039","07393080485885","07393089051265","00088381248723","00088381597036","00088381353267","00088381355094","00088381519663","00088381149143","00088381436755","00088381705462","00088381469210","00088381566186","00088381438766","00088381573023","07391736003827","07391883054246","07391883725771","00088381201179","00088381351614","00088381435048","00088381477086","00088381703086","00088381948654","04002829807149","00088381102551","03240890425560","00088381195959","00088381790857","00088381946742","00088381968386","04053423252910","07333377092709","00088381414241","00088381448116","01110003661807","07333377006133","00088381889025","01110003639370","01110003441676","00088381877664","00088381871839","00088381700498","00088381867757","00088381737739","00088381841252","00088381146630","04250559904939","04250559912293","04064677041298","04059952643298","03165140385220","00088381148962","00088381664646","00088381000734","00088381336703","00088381343176","00088381537391","00088381546430","00088381577342","00088381588478","00088381594387","00088381291804","00088381292672","00088381294218","00088381605717","00088381917520","00088381966313","03240890251954","00088381995009","00088381789646","00088381545310","03240890037213","04002829711958","00088381190251","04002829713792","04002829788608","04002829499573","04002829783313","00088381803298","00088381781107","00088381759793","00088381169189","00088381184250","00088381103589","00088381375399","00088381336321","00088381337021","00088381536752","00088381537377","00088381558495","00088381797153","00088381994316","01000001045443","07391736317702","07391883004487","07392930521520","07392930639782","07392930676381","00088381248532","00088381292795","00088381918497","04059612429880","04064677123604","04250559924401","00088381704182","00088381355070","03240890114167","00088381343299","03240890323965","00088381436694","00088381453400","00088381521345","00088381532228","00088381562331","00088381851701","00088381871921","07391883202883","07391883725979","07392930300040","07392930300095","07392930300132","07392930300248","07392930300330","07392930300484","07393089051210","00088381127561","00088381455268","00088381459747","00088381483094","00088381483131","00088381598897","00088381945059","00088381991322","00088381572354","00088381968638","03240890343499","00088381788724","00088381790970","00088381790994","00088381791052","00088381791076","00088381925433","00088381946957","00088381967969","00088381968294","00088381968379","00088381876780","00088381437820","00088381867894","00088381995979","00088381991308","00088381092876","00088381993326","04056835202948","04056835174559","00088381789509","00088381863087","00088381899291","00088381730006","00088381821803","00088381841375","00088381718905","01011056698003","04250559915157","03165140825757","04250559994190","04064677041304","03165140383110","00088381068093","00088381336376","00088381339384","00088381411172","00088381448260","00088381169035","00088381165839","00088381193658","00088381532389","00088381575010","00088381582285","00088381972772","00088381973380","03240890251947","00088381990127","00088381995061","00088381111669","00088381353540","00088381370295","00088381397520","03240890115300","00088381545792","00088381100557","00088381189422","00088381468565","08015774003555","08025518060508","04002829417942","04002829504932","04002829490365","00088381745215","00088381781275","00088381781848","00088381781732","00088381191234","03240890468901","00088381784795","00088381469111","00088381364881","00883819589818","00088381184823","00088381336161","00088381337076","00088381543071","07391736629461","07391883043905","07392930118638","07393080485601","08720023172851","06925387182955","00088381248327","00088381248495","04059612429897","00088381537704","07393089053542","04064677035228","00088381704175","00088381161824","00088381472746","00088381497206","00088381566506","00088381867719","00088381867726","07391736209960","07391883725993","07392930325333","00088381119320","00088381122733","00088381431620","00088381483247","00088381579490","00088381584098","00088381597371","00088381597753","00088381968225","00088381968263","00088381991100","00088381991148","03240890328045","00088381369923","00088381473712","00088381525671","00088381794374","00088381162081","00088381469586","00088381528696","00088381790680","00088381790802","00088381791144","00088381791168","04002829251607","04056835203303","00088381798747","03165140875196","05902062063885","00088381880084","01110003496522","04052993464747","00088381431026","00088381099110","08720023050784","03165140704557","03165140704588","04250559985662","04250559992721","04059952614151","04059952652078","03165140383868","00088381465564","00088381291477","00088381092883","00088381150606","00088381469050","00088381369558","00088381764209","00088381291835","00088381973298","00088381973397","00088381973441","00088381970372","00088381970679","00088381971362","00088381996020","00088381702096","00088381193771","00088381397988","03240890061553","04189444826554","00088381140904","00088381441469","00088381792059","00088381765176","00088381772587","00088381485944","00088381448338","00088381493093","00088381121699","00088381127820","00088381880077","00088381553322","00088381438049","00088381478366","00088381932394","00088381398336","04062321853785","00088381289283","00088381336185","00088381443050","00088381481311","00088381822404","07333377030657","07391736265904","07391883123645","07391883812396","07392930521049","07392930773219","00088381200035","03240890323958","00088381477895","00088381585125","00088381953108","00088381469241","03240890856029","00088381572965","00088381892698","07393080694348","00088381104470","00088381162463","00088381162975","00088381414395","00088381483148","00088381483223","00088381538718","00088381586092","00088381587488","00088381788809","00088381921367","00088381975254","00088381991407","04005337060488","00088381367349","00088381570824","00088381176514","00088381356718","00088381410458","00088381436953","00088381586917","00088381790581","00088381790789","00088381790888","00088381791007","00088381710220","00088381851985","04053423252521","04056835203259","04056835173811","07392930730526","00088381867535","04056835174542","00088381864152","05053184573124","00088381883566","04250559994145","04064677041274","00088381372329","04059952576640","03165140616867","00088381795050","03240890329714","07630153439872","00088381131650","00088381336123","00088381336352","00088381337137","00088381448161","00088381469081","00088381524056","00088381481854","00088381568388","00088381594103","00088381291361","00088381293372","00088381294461","00088381932899","00088381984447","00883814162078","00088381579261","00088381370288","00028295533508","00088381149891","08720023037150","08381101000000","04002829761151","00009520201607","00088381762335","00088381493208","00088381584050","00197050000569","07311518021979","00088381169004","00088381187091","00088381102568","00088381337588","00088381400350","00088381435192","07333377106093","07391883161388","07392930887879","07393080703644","08015774003562","00088381782302","00088381745291","00088381997331","04056835203174","04064677035310","00088381353168","00088381495264","00088381436748","00088381436618","00088381436632","00088381436625","00088381566223","00088381521444","00088381590273","00088381417112","00088381490276","00088381580595","00088381462280","00088381113908","00088381596923","00088381132527","00088381723213","00088381679374","07391883154847","07391883725696","07391883725801","07392930300064","07392930300521","07393080693877","07393080704139","07393080736932","07393089245589","00088381112260","00088381159241","00088381162593","00088381354462","00088381457132","00088381457255","00088381523752","00088381590426","00088381592024","00088381519687","00088381114240","00088381177986","00088381410373","00088381414494","00088381791199","00088381568746","07392930760516","03165140560047","01110003441928","01000001384108","04056835203198","01110003607294","07333377335738","07333377075535","07392930311510","00088381899284","00088381875653","00088381028257","00088381629263","00088381987608","04250559919346","04250559978534","04250559983439","04064677041373","04059952614700","03165140979214","03165140385046","03165140386029","00088381102575","08025518040647","00088381131643","00088381399807","00088381165822","00088381165884","00088381312868","00088381751186","00088381966320","00088381970655","00088381970709","00088381970723","00088381709699","00088381365871","00088381788410","00088381590037","00088381425551","00088381116176","04002829798911","00042365515263","01110003448767","00088381867900","04002829431504","04002829427095","04002829156636","00088381566087","00088381367905","00088381781480","00088381472975","00088381493185","00088381493222","00088381493277","00088381533935","00088381880909","00088381169097","00088381169288","00088381148979","00883813715756","00088381401722","00088381594318","00088381719766","00088381775069","03240890859747","07391883028094","07391883514955","07392930310476","07392930772854","07393080525031","00883815652028","00088381248204","00088381248457","00088381704205","00088381404648","00088381200899","00088381355063","00088381149037","00088381436724","00088381704083","00088381566193","00088381427999","00088381497190","00088381418591","00088381891394","07391883079447","07392930300408","07392930300422","00088381126403","00088381154666","00088381162562","00088381163125","00088381347921","00088381413275","00088381416535","00088381456357","00088381457118","00088381586610","00088381917384","00088381968508","03240890358196","04002829860380","00088381790604","00088381790734","00088381790871","00088381790963","00088381968454","00088381984690","00088381686679","00088381350792","01110003636003","04064677076702","04064677076719","00088381248266","04062321826239","04053423252613","00088381633109","07392930965829","07392930946750","04059952622569","00088381893411","00088381867566","00088381400626","00088381193634","04260525814803","04064677041441","04064677041311","04064677041236","04059952606972","00088381535762","00088381944960","04012789324945","07630153439889","00088381026574","03240890251442","00088381336826","00088381414265","00088381165273","00088381165938","00088381408868","00088381457613","00088381533102","00088381567190","00883817866836","00088381961158","00088381973199","00088381973236","00088381973243","00088381973403","00088381990110","00088381880411","00088381252850","00088381373524","00088381786904","00088381796002","00088381495684","03240890350329","00088381867559","00088381881821","00088381190671","03240890477248","00088381970334","00088381187145","00088381413978","00088381149013","00088381200011","00088381104531","00088381490184","00088381407212","00088381288514","00088381336154","00088381367585","00088381400282","00088381400725","00088381708739","04002829825259","07333377063648","07333377337190","07391736214735","07391883391907","07391883794388","07391883813461","07392930345409","07392930772946","07393080485632","07393080708977","00088381707213","00088381134354","00088381436717","00088381362566","00088381568715","03240890437730","00088381477512","00088381737715","00088381867733","07391883000960","07391883542347","07392930284838","00088381140959","00088381150255","00088381162692","00088381374095","00088381457224","00088381526302","00088381570510","00088381591058","00088381594134","00088381959612","00088381991209","04002829840115","00088381436946","00088381790932","00088381864220","00088381964326","00088381964357","00088381710244","04053423248852","04056835203334","04053423252606","00088381448253","04051363651633","00088381850575","00088381835978","00088381756266","00088381437387","01110003661951","01110003538871","04053423250374","00088381356589","00088381790062","07391736331937","00088381574716","00088381748599","00088381651080","04250559928157","04250559966487","04250559992677","04250559994138","04053423207439","04053423250510","00088381592062","00088381594899","07630153439926","00088381131636","00088381150071","00088381528764","00088381165648","00088381475822","00088381582827","00088381291828","00088381292689","00088381293365","00088381293389","00088381972000","00088381972451","00088381970389","00088381970532","00088381970648","00088381984454","00088381995092","00088381995726","00000016137110","","03240890111142","00000883436828","00088381192750","04002829422137","00088381566070","03240890358080","00088381148955","00088381651882","00883817201064","00088381337007","00088381884518","07391883185391","07391883367698","07391883548776","07391883725788","07392930512245","07392930765498","07393080704122","00088381519595","00088381727020","00088381248488","04056835174320","00088381481731","00088381700535","00088381436663","00088381469173","04002829760475","00088381573009","00088381348348","00088381600866","00088381654500","00088381803625","00088381872621","00883818962452","07392930286153","07392930300217","07392930300347","07392930883710","07393080693938","00088381146661","00088381191333","00088381431644","00088381441421","00088381483186","00088381498043","00088381525572","00088381580670","00088381598873","00088381946865","00088381362733","00088381376280","00088381410557","00088381433327","00088381594400","00088381790673","00088381790758","00088381791090","00088381592055","00088381884587","04053423252484","07392930946446","00088381798693","01110003661852","07391736371308","01110003479259","00088381800730","00088381748445","00088381006545","00088381866026","04250559910954","04250559989776","04250559992776","04064677041366","04064677041267","03165140764131","00088381996884","00088381156066","03165140087827","07630153439902","04012789586121","00088381822398","00088381149723","00088381337458","00088381414401","00088381421898","00088381537858","00088381475419","00088381764186","00088381589468","00088381291163","00088381291859","00088381292627","00088381773652","00088381972789","00088381970501","00088381995153","00088381709811","00000881362235","03240890117229","00088381132152","00088381442206","00088381192620","00088381863919","04002829491447","00088381770262","00088381484404","00088381374163","00088381946766","00088381149082","00088381334785","00088381336901","00088381404938","00088381625043","00088381783675","00088381799010","00088381872669","00088381892926","07333377033320","07391883548745","07391883985854","07392930888050","07393080485861","07393080816795","00088381874397","00088381248341","00088381248396","00088381248518","00088381406765","00088381917483","04053423252897","03240890452023","00088381404686","00088381436670","00088381436649","00088381566209","00088381992503","00088381142656","00088381113915","00088381373654","00088381836760","00088381859066","07391883726020","07392930300323","07392930544901","07393089245602","00088381137676","00088381157322","00088381162579","00088381164917","00088381165181","00088381365093","00088381409094","00088381553155","00088381585880","00088381587341","00088381587457","00088381594356","00088381922975","00088381946568","00088381947237","00088381971904","00088381972994","00088381980548","00088381980555","00088381983334","00088381991414","03240890303073","04002829776735","00088381360012","00088381519380","00088381114301","00088381150200","00088381586887","00088381790642","00088381790864","00088381791175","04002829549247","00088381521123","04059952577128","00088381448109","04062321855383","04053423242669","00088381140225","04002829571743","00883810970318","00088381769983","07333377075467","01110003441867","00088381807203","00088381749336","00088381841276","00088381730020","04250559901426","00088381998239","04250559915140","04250559983415","04250559983392","04250559992790","04250559994305","04064677041342","03165140688291","03165140883818","04053423215410","04053423235258","03165140749558","03165140385879","00088381160483","00088381291514","00088381414210","00088381165358","00088381166591","00088381187152","00088381187176","00088381204965","00088381423748","00088381568371","00088381294164","00088381961127","00088381966337","00088381990141","00088381415651","00088381350617","00088381121200","00088381585217","00088381374149","00088381489027","00088381484442","03240890045089","03240890055460","01110003453167","00088381366212","00088381207294","04002829407103","04002829761182","04002829129609","04002829523513","00088381781510","00088381775328","00088381990752","00088381990783","03240890425492","00088381780995","00088381453455","00088381169318","00088381584722","00088381591263","00088381289290","00088381418096","00088381497961","00088381520195","00088381570671","00088381576758","00088381860161","00088381883337","00088381994309","07333377075801","07391736367608","07391736367851","07391736441858","07391736638906","07391883813218","07392930286177","07392930300507","07392930360020","07393080485625","07393089077319","00088381248235","00088381418164","00088381558778","00088381404778","04064677035297","04064677123512","00088381485906","00088381404709","00088381353205","00088381149174","00088381704106","05706098000872","00088381432863","07391736619073","07391883010242","07391883726013","07391883726112","07392930300163","07392930300170","07392930300194","07392930300224","07392930544918","00088381155656","00088381162746","00088381189583","00088381200028","00088381453974","00088381584104","00088381587518","00088381922999","00088381980609","00088381473033","00088381758826","00088381414319","00088381469067","04062321855369","00088381686365","00088381795593","00088381787628","00088381757058","00088381835442","00088381754279","00088381678612","03165140625746","03165140825740","00088381525824","04250559966432","04250559995067","04064677041410","04064677041359","04064677095581","03165140107907","03165140385022","00088381291750","00088381566919","00088381594943","00088381595001","07612056506462","00088381337731","00088381477079","00088381537889","00088381165303","00088381186995","00088381788854","00088381970488","00088381970716","00088381994842","00088381660778","03240890257048","03240890291998","00088381121286","03240890284426","00088381420396","00088381458276","04002829909010","00088381434539","09610143749103","00088381761291","00088381843201","00088381764681","00088381460965","00088381169011","00088381787635","00088381149006","00088381140232","00088381595179","07333377033252","07333377094499","07391736168908","07391883035917","07392930762497","07393080736895","00197050002105","00197050001108","00088381248440","00088381248525","04059612429873","07392930539495","04064677123550","04056835203235","00088381158909","00088381576420","00088381469128","00088381403856","00088381582605","00088381529136","00088381459631","00088381490504","00088381398329","00088381570701","00088381102582","00088381730051","00088381734974","00088381779807","00088381877527","04002829845271","07391883008133","07391883080887","07392930300033","07392930300125","07392930674615","00088381146593","00088381161152","00088381164634","00088381182515","00088381207249","00088381409087","00088381431637","00088381458511","00088381538589","00088381576734","00088381703345","00088381703369","00088381991162","00088381173940","00088381417822","00088381968683","00088381102704","00088381291491","00088381292306","00088381410540","00088381436847","00088381790574","00088381790710","00088381968393","00088381968744","00088381975131","04026851007797","01110003441850","00088381990967","07393080353566","00088381448239","00088381205009","00088381824484","00088381844475","01110003441904","00088381879170","00883814328634","00088381888202","00088381836302","00088381794213","00088381705370","03165140825733","04250559978541","04064677041281","00088381547796","04053423244632","03165140416290","03165140546409","04012789053340","07630153439940","00088381414159","00088381537353","00088381537841","00088381205160","00088381313735","00088381293327","00088381769334","00088381949170","00088381973410","00088381970938","00088381843119","00088381350600","00088381161770","13594962751864","00088381436540","00088381448376","00088381518499","00088381192569","00088381113762","00088381760423","04002829381113","00088381781220","00088381781442","00088381867740","00088381190282","00088381756778","00088381464307","04250845515511","07333377473676","00088381194907","04062321640149","00088381463409","07391736209984","07392930212886","07392930300477","07392930336315","07392930521032","07392930641914","07392930651579","07393080392060","00088381248402","00088381992336","04059612429835","00088381571258","04064677123536","00088381416382","03240890323941","00088381152488","00088381148993","00088381158893","00088381477727","00088381178099","00088381705455","00088381200677","04002829441336","00088381573061","00088381486729","00088381205658","00088381364942","00088381778770","07391883154878","07391883819180","07392930300156","07392930300187","07392930300200","07392930300262","07392930300354","00088381140911","00088381141628","00088381155786","00088381162401","00088381162982","00088381352413","00088381569637","00088381703208","00088381946902","00088381991186","00088381991223","00088381996938","03240890317681","04002829860397","00088381200301","00088381473736","00088381477864","00088381149198","00088381162647","00088381292313","00088381436892","00088381790567","00088381790772","00088381790925","00088381791083","00088381791120","00088381791182","00088381867764","04059952574660","04056835203297","07392930880726","07333377075627","00088381993319","07392930884472","00088381996907","07391883815557","00088381873444","00088381867702","00088381843232","00088381880930","00088381869614","00088381795326","00088381971973","04250559912323","03165140625753","04250559982890","00088381976893","04059952526324","03165140749510","03165140385831","00088381196833","00088381537513","00088381537742","00088381537971","00088381540070","00088381165945","00088381165952","00088381369534","00088381449397","00088381475815","00088381575911","00088381787963","00088381291125","00088381085991","00088381917513","00088381961134","00088381972741","00088381970365","00088381984423","00088381996112","00000881627051","00088381799003","00088381453943","25401197108231","03240890379245","00000886312358","06351134635113","00088381196987","04002838092598","04002838103515","04002829155707","04002829755778","00088381781060","00088381764766","00088381970327","03240890251503","00088381486811","00088381171182","00088381196574","00088381404815","00088381149204","07333377473690","00088381081658","00088381418652","00088381464659","00088381645324","00088381742061","00088381754293","07333377093126","07391883805503","07391883985823","07393080890368","00088381248426","00088381248501","00088381991032","00088381991049","04064677123529","00088381114615","00088381704236","00088381353243","03240890323934","00088381170499","00088381170178","00088381477505","03240890323972","00088381149105","00088381436700","00088381598293","00088381444125","00088381142915","00088381434867","00088381134361","00088381680103","04002829763148","07391883725726","07391883726129","07392930300545","00088381119337","00088381142793","00088381150170","00088381152402","00088381162449","00088381189224","00088381348300","00088381369985","00088381579506","00088381579513","00088381589505","00088381968201","00088381968249","00088381968652","03240890096777","03240890096784","00088381118750","00088381207164","00088381399548","00088381291705","00088381433372","00088381436878","00088381586832","00088381586900","00088381597241","00088381790741","00088381791038","00088381791137","00088381844598","00088381975179","00088381991155","00088381991292","00088381710275","00088381288323","00088381740975","00088381433624","00088381448123","03165140084994","00088381038720","07393080650214","01110003661760","04053423253009","04056835203310","00088381888196","00088381899338","00088381848985","00088381858182","04250559912316","03165140894487","03165140230490","04250559988007","04250559992738","03165140560030","03165140749473","00088381337144","00088381477550","00088381169240","00088381165211","00088381165709","00088381187169","00088381187220","00088381787178","00088381859028","00088381291132","00088381973304","00088381973373","00088381115544","03240890272041","00088381350556","00088381427173","04002829724170","03240890055477","04002829521557","04002829487532","00088381768603","00088381781046","00008838152366","03240890425478","03240890425553","04005337147936","00088381370318","00088381181945","00088381036917","00088381188548","00088381775304","00197050002907","04002829831496","07391736346610","07391736392044","07391883028087","07392930300460","07392930513914","07392930887763","07393080371270","00088381248389","00088381248433","00088381248716","04056835203280","07392930946521","04250559953814","00088381353250","00088381155496","00088381436687","00088381477475","00088381787840","00088381469234","00088381573047","00088381573474","00088381570589","00088381784306","00088381820493","00088381872430","07391883038215","07391883202852","07393080736963","07393089051234","07393089245930","00088381117784","00088381156660","00088381162869","00088381164436","00088381348317","00088381408219","00088381458559","00088381459013","00088381540971","00088381917414","00088381968157","00088381968195","00088381980562","04002829843697","00088381292344","00088381467865","00088381704212","00088381790550","00088381790987","00088381996860","00088381851398","04056835203181","04053423252576","00088381414180","00088381798716","00197050002877","04053423252620","00088381292573","00088381990424","07333377451629","07391736981644","04056835205017","00088381884457","00088381882347","00088381679077","00088381875493","03165140825726","03165140949095","04250559983361","04064677127633","03165140495813","03165140438803","03165140978712","03165140383844","00088381572460","07630153439933","00088381092869","00088381437790","00088381440264","00088381169271","00088381166638","00088381187183","00088381187206","00088381204798","00088381560474","00088381577366","00088381589420","00088381787987","00088381788021","00088381294126","00088381629232","00088381945035","00088381970440","00088381970471","00088381996037","00088381700467","00088381702126","08720023033091","04002829743805","00088381158961","00088381719544","00088381582902","00088381248846","00088381193801","00088381374194","00088381026697","00088381340977","00088381535748","04002829395479","00088381781015","00088381781800","00088000010908","00088381781336","00088381546362","00088381537360","03240890469748","00088381433365","00088381475075","00088381169134","00088381975193","00088381495974","00088381538954","00088381708678","00088381769730","00088381857154","01000002444108","03276421422326","07391736219174","07391883974551","07392930358560","07393080525048","00088381248242","00088381248297","04056835203211","04064677035280","00088381485890","00088381469159","00088381444026","00088381573092","00088381521338","00088381521246","00088381521413","00088381539777","03240891002647","00088381142632","00088381679787","00088381783965","07391736210010","07391883027790","07392930300026","07392930300088","07392930300453","07393080736925","00088381163248","00088381294560","00088381409063","00088381415460","00088381433570","00088381437622","00088381460859","00088381968218","00088381991247","00088381991261","00088381991285","00088381991421","00088381195461","00088381413213","00088381425810","00088381560511","00088381585750","00088381102711","00088381586801","00088381597234","00088381790529","00088381790635","00088381790901","00088381794367","00088381775403","04062321595999","03165140116169","07391883815434","00088381864213","07332413566969","00088381292559","05711145277343","07333377033269","00088381841269","00088381751407","06925387173915","00088381996846","00088381867887","00088381829885","00088381864015","00088381757041","00088381871075","00088381839433","04250559946427","04250559966470"}

    def parse(self, response):
        gtin = response.xpath('//div[@id="product-description"]//p[contains(text(), "EAN/GTIN")]/text()').get(default="")
        if not gtin:
            return
        gtin = gtin.split(': ')[1]
        gtin = re.sub('\s+', ' ', gtin).strip()    
        if gtin not in self.sysgtin:
            return
        description = response.css('#product-description > div.t-panel__body.m-collapsible__target.m-collapsible__target--sm.m-collapsible__target--md > div > div.js-expandable-content.t-expandable__content > ul').getall()
        description = '\n'.join(description)
        if not description:
            return
        
        ProductDataItem = ProductItem()
        ProductDataItem['gtin'] = gtin
        ProductDataItem['longdesciprtion'] = description
        ProductDataItem['title'] =  response.css('h1.a-txt--product-name::text').get().strip()
        ProductDataItem['brand'] = response.css('div.m-brand-and-product-info__brand-name a::text').get().strip()
        ProductDataItem['manufacturerkey'] = response.css('div.m-brand-and-product-info__brand-name div.a-txt--regular-plus::text').getall()[-1].strip()
        breadcrumbs = response.css('ul.breadcrumbs li.js-breadcrumbs-item span[itemprop="name"]::text').getall()
        if breadcrumbs and breadcrumbs[0] == 'Startseite':
            breadcrumbs = breadcrumbs[1:]
        ProductDataItem['productType'] = '>'.join(breadcrumbs)
        yield ProductDataItem
        
        #artno = response.xpath('//*[@id="content"]/div[3]/div[1]/div[2]/div/div[4]/div/div[1]/div[2]/div[2]/span/text()').get()
        artno = re.search(r'(\d+)$',response.url)
        artno = artno.group(1)
        if not gtin:
            return
        ajax_url = f'https://www.contorion.de/catalog/lazy-detail/display-attributes/{artno}'
        headers = {
            "accept": "*/*",
            "accept-language": "de-DE,de;q=0.9,en-US;q=0.8,en;q=0.7",
            "sec-ch-ua": "\"Chromium\";v=\"122\", \"Not(A:Brand\";v=\"24\", \"Google Chrome\";v=\"122\"",
            "sec-ch-ua-mobile": "?0",
            "sec-ch-ua-platform": "\"Windows\"",
            "sec-fetch-dest": "empty",
            "sec-fetch-mode": "cors",
            "sec-fetch-site": "same-origin",
            "x-requested-with": "XMLHttpRequest"
        }

        yield scrapy.Request(ajax_url, callback=self.parse_ajax, headers=headers, cb_kwargs={"gtin":gtin}, errback=self.errback)

    def parse_ajax(self, response, gtin):    
        item = SpecItem()
        table = response.css('#product-details > div.t-panel__body.t-panel__body--unpadded.m-collapsible__target.m-collapsible__target--sm.m-collapsible__target--md > div > div.js-expandable-content.t-expandable__content > table > tbody > tr')
        for row in table:
            item['providerKey'] = gtin
            item['SpecificationKey'] = row.css('td:nth-child(1)::text').get()
            item['SpecificationValue'] = row.css('td:nth-child(2)::text').get()
            yield item

    def errback(self, failure):
        print(failure.request.meta)
